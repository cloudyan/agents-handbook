# 05 - Agent Weather

学习如何创建智能体（Agent），让 AI 能够使用工具获取实时天气信息并生成可视化图表。

## 文件说明

- `agent_weather.ipynb` - Jupyter Notebook 版本，包含完整的智能体演示和可视化功能
- `agent_weather.py` - Python 脚本版本，核心智能体功能演示

## 运行方法

### Jupyter Notebook（推荐）

```bash
jupyter lab langchain-python/05-agent-weather/
```

然后打开 `agent_weather.ipynb` 按顺序执行单元格。

### Python 脚本

```bash
cd langchain-python
python 05-agent-weather/agent_weather.py
```

## 学习目标

- 理解 Agent 的工作原理
- 掌握自定义工具的创建
- 学习 OpenAI Functions 的使用
- 实现实时数据获取和可视化

## 主要内容

### 1. 智能体基础概念
- Agent 是什么：能够自主使用工具完成复杂任务的 AI 系统
- 工作原理：Thought → Action → Observation → Final Answer
- 核心组件：LLM、Tools、AgentExecutor

### 2. 自定义工具创建
- 使用 `@tool` 装饰器创建工具
- 定义工具参数和返回值
- 工具描述和文档

### 3. 天气获取工具
- 模拟天气 API 数据
- 支持多城市查询
- 支持多天预报

### 4. 可视化工具（仅 Notebook 版本）
- 使用 matplotlib 生成天气图表
- 温度趋势图
- 湿度和风速图
- 天气状况分布图

### 5. 智能体执行
- AgentExecutor 管理执行流程
- OpenAI Functions 实现工具调用
- 多步推理和决策

## 关键概念

### Agent 工作流程
```
用户输入 → 思考(Thought) → 行动(Action) → 观察(Observation) → 最终回答(Final Answer)
```

### 核心组件
- **LLM**: 决策大脑，负责思考和决策
- **Tools**: 可调用的功能模块
- **Agent**: 协调 LLM 和工具的桥梁
- **AgentExecutor**: 执行引擎，管理运行流程

### 工具创建模式
```python
@tool
def tool_function(param1: str, param2: int) -> str:
    """工具描述，用于 LLM 理解工具功能。

    Args:
        param1: 参数1描述
        param2: 参数2描述

    Returns:
        返回值描述
    """
    # 工具实现
    return result
```

## 智能体类型

### 1. OpenAI Functions Agent
- 使用 OpenAI 的函数调用功能
- 自动选择合适的工具
- 支持复杂的多步骤任务

### 2. ReAct Agent
- 显式的推理和行动循环
- 更透明的决策过程
- 适合需要详细推理的场景

### 3. Self-Ask Agent
- 自问自答的推理方式
- 适合复杂的多跳查询
- 能够分解复杂问题

## 实际应用场景

### 智能客服
```
用户: "查询我的订单状态"
Agent:
1. 思考: 需要查询订单信息
2. 行动: 调用 query_order 工具
3. 观察: 获取订单状态
4. 回答: 告知用户订单状态
```

### 个人助理
```
用户: "帮我安排明天会议"
Agent:
1. 思考: 需要检查日程、发送邀请
2. 行动: 调用 check_calendar 工具
3. 观察: 获取空闲时间
4. 行动: 调用 send_invitation 工具
5. 观察: 确认发送成功
6. 回答: 告知用户会议已安排
```

### 数据分析助手
```
用户: "分析销售数据并生成报告"
Agent:
1. 思考: 需要获取数据、分析、可视化
2. 行动: 调用 get_sales_data 工具
3. 观察: 获取原始数据
4. 行动: 调用 analyze_data 工具
5. 观察: 获取分析结果
6. 行动: 调用 create_chart 工具
7. 观察: 生成图表
8. 回答: 提供分析报告和图表
```

## 工具设计最佳实践

### 1. 工具命名
- 使用清晰、描述性的名称
- 避免缩写和模糊词汇
- 保持命名一致性

### 2. 参数设计
- 提供合理的默认值
- 使用类型提示
- 详细的参数说明

### 3. 返回值格式
- 结构化的返回数据
- 包含错误处理
- 便于后续处理

### 4. 错误处理
- 捕获并处理异常
- 提供有意义的错误信息
- 优雅降级

## 性能优化

### 1. 工具调用优化
- 缓存频繁调用的结果
- 批量处理相关操作
- 异步执行耗时操作

### 2. 智能体配置
- 设置合理的最大迭代次数
- 优化提示词模板
- 选择合适的 LLM 模型

### 3. 资源管理
- 及时释放资源
- 监控内存使用
- 限制并发调用

## 环境要求

- Python ≥ 3.11
- 已安装 requirements.txt 中的依赖
- 已设置 OPENAI_API_KEY 环境变量
- 可选：matplotlib（用于可视化功能）

## 预期输出

```
🦜🔗 05 - Agent Weather
========================================
✓ LangChain 组件导入完成

=== 1. 创建天气获取工具 ===
✓ 天气获取工具创建完成

=== 2. 创建智能体 ===
✓ 天气智能体创建完成

=== 3. 测试智能体 ===

问题：查询北京明天的天气情况
回答：根据天气数据，明天北京的天气情况如下...
[详细的天气分析和建议...]

问题：上海未来3天天气怎么样？
回答：上海未来3天的天气预报...
[多天天气总结...]

问题：明天我需要带伞吗？我在广州
回答：根据广州明天的天气预报...
[具体的穿衣和出行建议...]

=== 4. 天气数据分析演示 ===

北京 未来 3 天天气：

日期：2025-01-07
温度：15-25°C
天气：晴
湿度：45%
风速：8 km/h
降雨：否

[更多天气数据...]

🎉 Agent Weather 示例运行成功！
```

## 下一步

完成这个示例后，可以继续学习：
- 06 - API Deployment（FastAPI 部署）

## 扩展学习

- 尝试集成真实的天气 API（如 OpenWeatherMap）
- 创建更多工具（地图查询、交通信息等）
- 实现多智能体协作
- 添加记忆功能到智能体
- 集成语音交互功能
